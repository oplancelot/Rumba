# Rumba - Rust LTFS Git-like Backup Tool

é«˜æ€§èƒ½çš„ LTO ç£å¸¦å¢é‡å¤‡ä»½å·¥å…·ï¼Œä½¿ç”¨ Git ç†å¿µè¿›è¡Œå†…å®¹å¯»å€å­˜å‚¨ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **é…ç½®æ–‡ä»¶ç®¡ç†**: æ”¯æŒ TOML æ ¼å¼çš„é…ç½®æ–‡ä»¶
- âœ… **SMB å‡­è¯ç®¡ç†**: æ”¯æŒ Samba å…±äº«çš„ç”¨æˆ·å/å¯†ç è®¤è¯
- âœ… **å¯†ç æ¨¡ç³ŠåŒ–**: ä½¿ç”¨ Base64 ç¼–ç ä¿æŠ¤é…ç½®æ–‡ä»¶ä¸­çš„å¯†ç 
- âœ… **å¢é‡å¤‡ä»½**: åŸºäºæ–‡ä»¶å†…å®¹ Hash çš„å»é‡å’Œç´¢å¼•
- âœ… **redb å…ƒæ•°æ®å­˜å‚¨**: ä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å­˜å‚¨å¤‡ä»½å…ƒæ•°æ®
- âœ… **Git-like æœºåˆ¶**: å†…å®¹å¯»å€å­˜å‚¨ (CAS) + Merkle Tree
- ğŸš§ **LTFS é›†æˆ**: è®¡åˆ’é›†æˆ rustltfs è¿›è¡ŒçœŸå®ç£å¸¦å†™å…¥

## æ¶æ„ä¸åŸç†

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

Rumba å€Ÿé‰´äº† Git çš„å†…éƒ¨æœºåˆ¶ï¼Œä¸“ä¸ºæµ·é‡æ–‡ä»¶å¤‡ä»½è®¾è®¡ï¼š

1.  **å†…å®¹å¯»å€å­˜å‚¨ (CAS)**:
    - æ–‡ä»¶ä¸æŒ‰æ–‡ä»¶åå­˜å‚¨ï¼Œè€Œæ˜¯æŒ‰å†…å®¹çš„ BLAKE3 å“ˆå¸Œå­˜å‚¨ã€‚
    - **è‡ªåŠ¨å»é‡**: ç›¸åŒå†…å®¹çš„æ–‡ä»¶ï¼ˆå³ä½¿æ–‡ä»¶åä¸åŒï¼‰åªå­˜å‚¨ä¸€ä»½æ•°æ®ã€‚
    - **æ•°æ®å®Œæ•´æ€§**: å“ˆå¸Œå€¼å³æ ¡éªŒå’Œï¼Œå¤©ç„¶é˜²æ­¢é™é»˜æ•°æ®æŸåã€‚

2.  **é«˜æ•ˆå¢é‡å¤‡ä»½**:
    - **Level 1 - å¿«é€Ÿæ£€æŸ¥**: å¯¹æ¯”æ–‡ä»¶ `mtime` å’Œ `size`ï¼ˆç±»ä¼¼ Git Indexï¼‰ã€‚å¦‚æœæœªå˜ï¼Œç›´æ¥è·³è¿‡ã€‚
    - **Level 2 - å†…å®¹æ£€æŸ¥**: å¦‚æœå…ƒæ•°æ®å˜åŒ–ï¼Œè®¡ç®—å†…å®¹å“ˆå¸Œã€‚æŸ¥è¯¢æ•°æ®åº“ `blobs` è¡¨ï¼Œå¦‚æœå“ˆå¸Œå·²å­˜åœ¨ï¼Œä»…æ›´æ–°ç´¢å¼•ï¼ˆæ— éœ€é‡ä¼ æ•°æ®ï¼‰ã€‚
    - **Level 3 - æ•°æ®å†™å…¥**: åªæœ‰å…¨æ–°çš„å†…å®¹å—æ‰ä¼šè¢«å†™å…¥ç£å¸¦ã€‚

3.  **å…ƒæ•°æ®åˆ†ç¦»**:
    - æ–‡ä»¶å†…å®¹æµå¼å†™å…¥ç£å¸¦ï¼ˆçº¿æ€§å­˜å‚¨ï¼Œé€‚åˆ LTOï¼‰ã€‚
    - æ–‡ä»¶å…ƒæ•°æ®ï¼ˆæ–‡ä»¶åã€æƒé™ã€ç›®å½•ç»“æ„ï¼‰å­˜å‚¨åœ¨å¿«é€Ÿçš„æœ¬åœ° KV æ•°æ®åº“ (redb) ä¸­ã€‚

### ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TD
    Source[SMB å…±äº«æº] -->|å¹¶è¡Œæ‰«æ jwalk| Scanner(æ‰«æå™¨)
    Scanner -->|æ’åºåçš„ç›®å½•æµ| Pipeline{Pipeline æµæ°´çº¿}
    
    subgraph Pipeline Process [Pipeline å¤„ç†æµç¨‹]
        Pipeline -->|è‡ªåº•å‘ä¸Šæ„å»ºæ ‘| TreeBuilder[Merkle Tree æ„å»º]
        TreeBuilder -->|1. æ£€æŸ¥ mtime/size| IndexCheck{ç´¢å¼•æ£€æŸ¥}
        IndexCheck -->|æœªä¿®æ”¹| Skip[è·³è¿‡]
        IndexCheck -->|å·²ä¿®æ”¹| Hasher[è®¡ç®— BLAKE3]
        Hasher -->|2. æ£€æŸ¥å†…å®¹å“ˆå¸Œ| DedupCheck{å»é‡æ£€æŸ¥}
        DedupCheck -->|Hash å·²å­˜åœ¨| UpdateIdx[ä»…æ›´æ–°ç´¢å¼•]
        DedupCheck -->|æ–° Hash| NewFile[åŠ å…¥å¤‡ä»½è®¡åˆ’]
    end
    
    NewFile --> BackupPlan[ç”Ÿæˆå¤‡ä»½è®¡åˆ’]
    
    BackupPlan --> TapeWriter(ç£å¸¦å†™å…¥å™¨)
    TapeWriter -->|æµå¼æ‰“åŒ… (Tar)| Output[Output: rustltfs / tar]
    
    TapeWriter -.->|3. äº‹åŠ¡æäº¤| DB[(Redb å…ƒæ•°æ®åº“)]
    
    DB <--> IndexCheck
    DB <--> DedupCheck
```

### æ ¸å¿ƒæ¨¡å—ä¸å‡½æ•°è°ƒç”¨è¯´æ˜

#### 1. Scanner (`src/scanner.rs`)
è´Ÿè´£æ–‡ä»¶ç³»ç»Ÿçš„éå†ã€‚
- **`scan_parallel`**: ä½¿ç”¨ `jwalk` è¿›è¡Œå¤šçº¿ç¨‹é€’å½’æ‰«æã€‚
  - **å…³é”®ç‰¹æ€§**: ä¸ºäº†ä¿è¯ Merkle Tree è®¡ç®—çš„ç¡®å®šæ€§ï¼Œåœ¨å¤„ç†æ¯ä¸ªç›®å½•æ—¶ï¼Œä¼šå¯¹å­é¡¹æŒ‰æ–‡ä»¶åè¿›è¡Œ**ä¸¥æ ¼æ’åº** (`children.sort_by`)ã€‚
  - **è¾“å‡º**: é€šè¿‡ Channel å‘é€ `ScannedDir` ç»“æ„ï¼ŒåŒ…å«æ’åºåçš„ç›®å½•æ¡ç›®ã€‚

#### 2. Pipeline (`src/pipeline.rs`)
å¤‡ä»½æµç¨‹çš„ç¼–æ’è€…ï¼Œé‡‡ç”¨**è‡ªåº•å‘ä¸Š (Bottom-Up)** ç­–ç•¥ã€‚
- **`run`**: å¯åŠ¨æ‰«æçº¿ç¨‹ï¼Œæ¥æ”¶æ‰«æç»“æœã€‚
  - **æ’åº**: å°†æ‰€æœ‰è·¯å¾„æŒ‰é•¿åº¦é™åºæ’åºï¼ˆå…ˆå¤„ç†å¶å­èŠ‚ç‚¹/å­ç›®å½•ï¼Œå†å¤„ç†çˆ¶ç›®å½•ï¼‰ã€‚
  - **Tree æ„å»º**: é€å±‚è®¡ç®—ç›®å½•çš„ Merkle Hashã€‚å­ç›®å½•çš„ Hash ä¼šè¢«çˆ¶ç›®å½•å¼•ç”¨ã€‚
  - **æ–‡ä»¶å¤„ç†**: å¯¹æ¯ä¸ªæ–‡ä»¶è°ƒç”¨ Diff å¼•æ“ã€‚

#### 3. Diff Engine (`src/diff.rs`)
è´Ÿè´£åˆ¤æ–­æ–‡ä»¶æ˜¯å¦éœ€è¦å¤‡ä»½ã€‚
- **`check_index(path, mtime, size)`**: æŸ¥è¯¢ `index` è¡¨ã€‚å¦‚æœ mtime å’Œ size åŒ¹é…ï¼Œè¿”å› `Some(Hash)`ï¼ˆè·³è¿‡å“ˆå¸Œè®¡ç®—ï¼‰ã€‚
- **`should_backup_blob(hash)`**: æŸ¥è¯¢ `blobs` è¡¨ã€‚å¦‚æœ Hash å·²å­˜åœ¨ï¼Œè¿”å› `false`ï¼ˆè·³è¿‡æ•°æ®ä¼ è¾“ï¼Œä»…æ›´æ–°å¼•ç”¨ï¼‰ã€‚

#### 4. Tape Writer (`src/tape.rs`)
è´Ÿè´£å°†æ–‡ä»¶æ‰“åŒ…å¹¶å†™å…¥ç›®æ ‡ã€‚
- **`write_plan`**: æ¥æ”¶ `BackupPlan`ï¼Œéå†æ–°å¢æ–‡ä»¶åˆ—è¡¨ã€‚
- **Tar æ‰“åŒ…**: ä½¿ç”¨ `tar::Builder` ç”Ÿæˆæ ‡å‡† Tar æµã€‚
  - **æ–‡ä»¶åæ ¼å¼**: `original_filename_hash` (ä¾‹å¦‚ `report.pdf_a1b2c3...`)ï¼Œç¡®ä¿æ–‡ä»¶åå”¯ä¸€ä¸”åŒ…å«å†…å®¹æŒ‡çº¹ã€‚
- **è¾“å‡ºæ¨¡å¼**:
  - **`RustLtfs`**: å¯åŠ¨ `rustltfs` å­è¿›ç¨‹ï¼Œé€šè¿‡ Stdin ç®¡é“ä¼ è¾“æ•°æ®ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰ã€‚
  - **`TarFile`**: å†™å…¥æœ¬åœ°æ–‡ä»¶ï¼Œæ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰ã€‚

#### 5. Database (`src/db.rs`)
å°è£… `redb` æ“ä½œï¼Œä½¿ç”¨ `rkyv` è¿›è¡Œé›¶æ‹·è´åºåˆ—åŒ–ã€‚
- **è¡¨ç»“æ„**:
  - `blobs`: `Hash -> (TapeID, Offset)` (å»é‡ç´¢å¼•)
  - `index`: `Path -> (Mtime, Size, Hash)` (å¿«é€Ÿå¢é‡ç´¢å¼•)
  - `trees`: `Hash -> Vec<TreeEntry>` (ç›®å½•ç»“æ„ï¼Œå¾…å®Œå–„)
- **å¯¹é½å¤„ç†**: åœ¨è¯»å–æ•°æ®æ—¶ä½¿ç”¨ `to_vec()` å°†æ•°æ®å¤åˆ¶åˆ°å¯¹é½çš„å†…å­˜ç¼“å†²åŒºï¼Œè§£å†³ `rkyv` çš„å¯¹é½è¦æ±‚ã€‚

#### 6. Data Models (`src/models.rs`)
å®šä¹‰æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå‡æ”¯æŒ `rkyv` é›¶æ‹·è´åºåˆ—åŒ–ã€‚
- **`FileMetadata`**: æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆå¤§å°ã€mtimeã€æƒé™ç­‰ï¼‰ã€‚
- **`TreeEntry`**: ç›®å½•æ ‘ä¸­çš„èŠ‚ç‚¹ï¼ŒåŒ…å«æ–‡ä»¶åã€æ¨¡å¼å’Œ Hash æŒ‡é’ˆã€‚
- **`BlobLocation`**: è®°å½• Blob åœ¨ç£å¸¦ä¸Šçš„ç‰©ç†ä½ç½®ï¼ˆTapeID + Offsetï¼‰ã€‚


## æ¶æ„ä¸åŸç†

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

Rumba å€Ÿé‰´äº† Git çš„å†…éƒ¨æœºåˆ¶ï¼Œä¸“ä¸ºæµ·é‡æ–‡ä»¶å¤‡ä»½è®¾è®¡ï¼š

1.  **å†…å®¹å¯»å€å­˜å‚¨ (CAS)**:
    - æ–‡ä»¶ä¸æŒ‰æ–‡ä»¶åå­˜å‚¨ï¼Œè€Œæ˜¯æŒ‰å†…å®¹çš„ BLAKE3 å“ˆå¸Œå­˜å‚¨ã€‚
    - **è‡ªåŠ¨å»é‡**: ç›¸åŒå†…å®¹çš„æ–‡ä»¶ï¼ˆå³ä½¿æ–‡ä»¶åä¸åŒï¼‰åªå­˜å‚¨ä¸€ä»½æ•°æ®ã€‚
    - **æ•°æ®å®Œæ•´æ€§**: å“ˆå¸Œå€¼å³æ ¡éªŒå’Œï¼Œå¤©ç„¶é˜²æ­¢é™é»˜æ•°æ®æŸåã€‚

2.  **é«˜æ•ˆå¢é‡å¤‡ä»½**:
    - **Level 1 - å¿«é€Ÿæ£€æŸ¥**: å¯¹æ¯”æ–‡ä»¶ `mtime` å’Œ `size`ï¼ˆç±»ä¼¼ Git Indexï¼‰ã€‚å¦‚æœæœªå˜ï¼Œç›´æ¥è·³è¿‡ã€‚
    - **Level 2 - å†…å®¹æ£€æŸ¥**: å¦‚æœå…ƒæ•°æ®å˜åŒ–ï¼Œè®¡ç®—å†…å®¹å“ˆå¸Œã€‚æŸ¥è¯¢æ•°æ®åº“ `blobs` è¡¨ï¼Œå¦‚æœå“ˆå¸Œå·²å­˜åœ¨ï¼Œä»…æ›´æ–°ç´¢å¼•ï¼ˆæ— éœ€é‡ä¼ æ•°æ®ï¼‰ã€‚
    - **Level 3 - æ•°æ®å†™å…¥**: åªæœ‰å…¨æ–°çš„å†…å®¹å—æ‰ä¼šè¢«å†™å…¥ç£å¸¦ã€‚

3.  **å…ƒæ•°æ®åˆ†ç¦»**:
    - æ–‡ä»¶å†…å®¹æµå¼å†™å…¥ç£å¸¦ï¼ˆçº¿æ€§å­˜å‚¨ï¼Œé€‚åˆ LTOï¼‰ã€‚
    - æ–‡ä»¶å…ƒæ•°æ®ï¼ˆæ–‡ä»¶åã€æƒé™ã€ç›®å½•ç»“æ„ï¼‰å­˜å‚¨åœ¨å¿«é€Ÿçš„æœ¬åœ° KV æ•°æ®åº“ (redb) ä¸­ã€‚

### ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TD
    Source[SMB å…±äº«æº] -->|å¹¶è¡Œæ‰«æ jwalk| Scanner(æ‰«æå™¨)
    Scanner -->|æ’åºåçš„ç›®å½•æµ| Pipeline{Pipeline æµæ°´çº¿}
    
    subgraph Pipeline Process [Pipeline å¤„ç†æµç¨‹]
        Pipeline -->|è‡ªåº•å‘ä¸Šæ„å»ºæ ‘| TreeBuilder[Merkle Tree æ„å»º]
        TreeBuilder -->|1. æ£€æŸ¥ mtime/size| IndexCheck{ç´¢å¼•æ£€æŸ¥}
        IndexCheck -->|æœªä¿®æ”¹| Skip[è·³è¿‡]
        IndexCheck -->|å·²ä¿®æ”¹| Hasher[è®¡ç®— BLAKE3]
        Hasher -->|2. æ£€æŸ¥å†…å®¹å“ˆå¸Œ| DedupCheck{å»é‡æ£€æŸ¥}
        DedupCheck -->|Hash å·²å­˜åœ¨| UpdateIdx[ä»…æ›´æ–°ç´¢å¼•]
        DedupCheck -->|æ–° Hash| NewFile[åŠ å…¥å¤‡ä»½è®¡åˆ’]
    end
    
    NewFile --> BackupPlan[ç”Ÿæˆå¤‡ä»½è®¡åˆ’]
    
    BackupPlan --> TapeWriter(ç£å¸¦å†™å…¥å™¨)
    TapeWriter -->|æµå¼æ‰“åŒ… (Tar)| Output[Output: rustltfs / tar]
    
    TapeWriter -.->|3. äº‹åŠ¡æäº¤| DB[(Redb å…ƒæ•°æ®åº“)]
    
    DB <--> IndexCheck
    DB <--> DedupCheck
```

### æ ¸å¿ƒæ¨¡å—ä¸å‡½æ•°è°ƒç”¨è¯´æ˜

#### 1. Scanner (`src/scanner.rs`)
è´Ÿè´£æ–‡ä»¶ç³»ç»Ÿçš„éå†ã€‚
- **`scan_parallel`**: ä½¿ç”¨ `jwalk` è¿›è¡Œå¤šçº¿ç¨‹é€’å½’æ‰«æã€‚
  - **å…³é”®ç‰¹æ€§**: ä¸ºäº†ä¿è¯ Merkle Tree è®¡ç®—çš„ç¡®å®šæ€§ï¼Œåœ¨å¤„ç†æ¯ä¸ªç›®å½•æ—¶ï¼Œä¼šå¯¹å­é¡¹æŒ‰æ–‡ä»¶åè¿›è¡Œ**ä¸¥æ ¼æ’åº** (`children.sort_by`)ã€‚
  - **è¾“å‡º**: é€šè¿‡ Channel å‘é€ `ScannedDir` ç»“æ„ï¼ŒåŒ…å«æ’åºåçš„ç›®å½•æ¡ç›®ã€‚

#### 2. Pipeline (`src/pipeline.rs`)
å¤‡ä»½æµç¨‹çš„ç¼–æ’è€…ï¼Œé‡‡ç”¨**è‡ªåº•å‘ä¸Š (Bottom-Up)** ç­–ç•¥ã€‚
- **`run`**: å¯åŠ¨æ‰«æçº¿ç¨‹ï¼Œæ¥æ”¶æ‰«æç»“æœã€‚
  - **æ’åº**: å°†æ‰€æœ‰è·¯å¾„æŒ‰é•¿åº¦é™åºæ’åºï¼ˆå…ˆå¤„ç†å¶å­èŠ‚ç‚¹/å­ç›®å½•ï¼Œå†å¤„ç†çˆ¶ç›®å½•ï¼‰ã€‚
  - **Tree æ„å»º**: é€å±‚è®¡ç®—ç›®å½•çš„ Merkle Hashã€‚å­ç›®å½•çš„ Hash ä¼šè¢«çˆ¶ç›®å½•å¼•ç”¨ã€‚
  - **æ–‡ä»¶å¤„ç†**: å¯¹æ¯ä¸ªæ–‡ä»¶è°ƒç”¨ Diff å¼•æ“ã€‚

#### 3. Diff Engine (`src/diff.rs`)
è´Ÿè´£åˆ¤æ–­æ–‡ä»¶æ˜¯å¦éœ€è¦å¤‡ä»½ã€‚
- **`check_index(path, mtime, size)`**: æŸ¥è¯¢ `index` è¡¨ã€‚å¦‚æœ mtime å’Œ size åŒ¹é…ï¼Œè¿”å› `Some(Hash)`ï¼ˆè·³è¿‡å“ˆå¸Œè®¡ç®—ï¼‰ã€‚
- **`should_backup_blob(hash)`**: æŸ¥è¯¢ `blobs` è¡¨ã€‚å¦‚æœ Hash å·²å­˜åœ¨ï¼Œè¿”å› `false`ï¼ˆè·³è¿‡æ•°æ®ä¼ è¾“ï¼Œä»…æ›´æ–°å¼•ç”¨ï¼‰ã€‚

#### 4. Tape Writer (`src/tape.rs`)
è´Ÿè´£å°†æ–‡ä»¶æ‰“åŒ…å¹¶å†™å…¥ç›®æ ‡ã€‚
- **`write_plan`**: æ¥æ”¶ `BackupPlan`ï¼Œéå†æ–°å¢æ–‡ä»¶åˆ—è¡¨ã€‚
- **Tar æ‰“åŒ…**: ä½¿ç”¨ `tar::Builder` ç”Ÿæˆæ ‡å‡† Tar æµã€‚
  - **æ–‡ä»¶åæ ¼å¼**: `original_filename_hash` (ä¾‹å¦‚ `report.pdf_a1b2c3...`)ï¼Œç¡®ä¿æ–‡ä»¶åå”¯ä¸€ä¸”åŒ…å«å†…å®¹æŒ‡çº¹ã€‚
- **è¾“å‡ºæ¨¡å¼**:
  - **`RustLtfs`**: å¯åŠ¨ `rustltfs` å­è¿›ç¨‹ï¼Œé€šè¿‡ Stdin ç®¡é“ä¼ è¾“æ•°æ®ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰ã€‚
  - **`TarFile`**: å†™å…¥æœ¬åœ°æ–‡ä»¶ï¼Œæ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰ã€‚

#### 5. Database (`src/db.rs`)
å°è£… `redb` æ“ä½œï¼Œä½¿ç”¨ `rkyv` è¿›è¡Œé›¶æ‹·è´åºåˆ—åŒ–ã€‚
- **è¡¨ç»“æ„**:
  - `blobs`: `Hash -> (TapeID, Offset)` (å»é‡ç´¢å¼•)
  - `index`: `Path -> (Mtime, Size, Hash)` (å¿«é€Ÿå¢é‡ç´¢å¼•)
  - `trees`: `Hash -> Vec<TreeEntry>` (ç›®å½•ç»“æ„ï¼Œå¾…å®Œå–„)
- **å¯¹é½å¤„ç†**: åœ¨è¯»å–æ•°æ®æ—¶ä½¿ç”¨ `to_vec()` å°†æ•°æ®å¤åˆ¶åˆ°å¯¹é½çš„å†…å­˜ç¼“å†²åŒºï¼Œè§£å†³ `rkyv` çš„å¯¹é½è¦æ±‚ã€‚


## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æ–‡ä»¶è®¾ç½®

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶å¹¶ç¼–è¾‘ï¼š

```bash
copy config.example.toml config.toml
```

ç¼–è¾‘ `config.toml` å¡«å…¥ä½ çš„ SMB å‡­è¯ï¼š

```toml
[source]
url = "\\\\server\\share\\path"
username = "your_username"
password = "your_password"  # æˆ–ä½¿ç”¨ base64 ç¼–ç 

[target]
tape_path = "tape_drive.tar"
db_path = "backup_meta.redb"

[backup]
parallel_threads = 4
compression_level = 3
```

### 2. å¯†ç ç¼–ç ï¼ˆå¯é€‰ï¼‰

ä¸ºäº†é¿å…æ˜æ–‡å­˜å‚¨å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨ Base64 ç¼–ç ï¼š

```bash
cargo run --bin rumba -- encode-password "your_password"
```

å°†è¾“å‡ºçš„ `base64:xxx` ç²˜è´´åˆ°é…ç½®æ–‡ä»¶çš„ `password` å­—æ®µã€‚

### 3. è¿è¡Œå¤‡ä»½

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶ config.toml
cargo run --bin rumba

# æˆ–æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
cargo run --bin rumba -- --config /path/to/config.toml
```

### 4. æ£€æŸ¥æ•°æ®åº“å†…å®¹

ä½¿ç”¨ `db-inspect` å·¥å…·æŸ¥çœ‹å¤‡ä»½å…ƒæ•°æ®ï¼š

```bash
# æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
cargo run --bin db-inspect -- stats

# åˆ—å‡ºæ‰€æœ‰ blobs
cargo run --bin db-inspect -- list-blobs

# åˆ—å‡ºç´¢å¼•æ¡ç›®
cargo run --bin db-inspect -- list-index

# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„ç´¢å¼•
cargo run --bin db-inspect -- show-index "\\\\server\\share\\file.txt"
```

## æµ‹è¯•

### è‡ªåŠ¨åŒ–æµ‹è¯•

è¿è¡Œæä¾›çš„æµ‹è¯•è„šæœ¬ï¼š

```bash
.\test_config.bat
```

è¯¥è„šæœ¬ä¼šï¼š
1. æ¸…ç†æ—§çš„æµ‹è¯•æ•°æ®
2. æµ‹è¯•å¯†ç ç¼–ç 
3. è¿è¡Œé¦–æ¬¡å¤‡ä»½ï¼ˆæ‰€æœ‰æ–‡ä»¶åº”ä¸ºæ–°æ–‡ä»¶ï¼‰
4. éªŒè¯æ•°æ®åº“å’Œç£å¸¦æ–‡ä»¶å·²åˆ›å»º
5. è¿è¡Œç¬¬äºŒæ¬¡å¤‡ä»½ï¼ˆåº”è·³è¿‡æ‰€æœ‰æœªä¿®æ”¹æ–‡ä»¶ï¼‰
6. æ˜¾ç¤ºæ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯

### æ‰‹åŠ¨æµ‹è¯•

æµ‹è¯•ä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼ˆæŒ‰ç…§æä¾›çš„æµ‹è¯•è®¡åˆ’ï¼‰ï¼š

#### æµ‹è¯• 1: SMB æ–‡ä»¶å·®å¼‚è¯†åˆ«

```bash
cargo run --bin rumba -- --config config_test.toml
```

éªŒè¯ç‚¹ï¼š
- ç¨‹åºæˆåŠŸè¿æ¥åˆ° SMB å…±äº«
- æ‰«æå™¨éå†æ‰€æœ‰æ–‡ä»¶
- æ—¥å¿—æ˜¾ç¤ºæ‰«æçš„æ–‡ä»¶æ•°é‡

#### æµ‹è¯• 2: redb æ•°æ®åº“å­˜å‚¨

```bash
# é¦–æ¬¡å¤‡ä»½
cargo run --bin rumba -- --config config_test.toml

# ç¬¬äºŒæ¬¡å¤‡ä»½ï¼ˆåº”æ˜¾ç¤º "Nothing to backup"ï¼‰
cargo run --bin rumba -- --config config_test.toml

# æ£€æŸ¥æ•°æ®åº“
cargo run --bin db-inspect -- stats
```

#### æµ‹è¯• 3: æ–‡ä»¶æµè¾“å‡ºï¼ˆMock rustltfsï¼‰

```bash
# è¿è¡Œå¤‡ä»½
cargo run --bin rumba -- --config config_test.toml

# æ£€æŸ¥ç”Ÿæˆçš„ tar æ–‡ä»¶
tar -tvf tape_drive.tar
```

å½“å‰å®ç°å°†æ–‡ä»¶æµå†™å…¥æœ¬åœ° `tape_drive.tar` æ–‡ä»¶ã€‚æœªæ¥å¯ä»¥é€šè¿‡ç®¡é“ä¼ é€’ç»™ `rustltfs` è¿›ç¨‹ã€‚

## é¡¹ç›®ç»“æ„

```
Rumba/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs          # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ lib.rs           # åº“æ¥å£
â”‚   â”œâ”€â”€ config.rs        # é…ç½®æ–‡ä»¶ç®¡ç† â­ NEW
â”‚   â”œâ”€â”€ models.rs        # æ•°æ®ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ db.rs            # redb æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ scanner.rs       # æ–‡ä»¶æ‰«æå™¨
â”‚   â”œâ”€â”€ pipeline.rs      # å¤‡ä»½æµæ°´çº¿
â”‚   â”œâ”€â”€ diff.rs          # å·®å¼‚è®¡ç®—å¼•æ“
â”‚   â”œâ”€â”€ tape.rs          # ç£å¸¦å†™å…¥å™¨
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ db_inspect.rs # æ•°æ®åº“æ£€æŸ¥å·¥å…· â­ NEW
â”œâ”€â”€ config.example.toml   # é…ç½®æ–‡ä»¶ç¤ºä¾‹ â­ NEW
â”œâ”€â”€ config_test.toml      # æµ‹è¯•é…ç½® â­ NEW
â”œâ”€â”€ test_config.bat       # è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ â­ NEW
â”œâ”€â”€ TEST_PLAN.md          # è¯¦ç»†æµ‹è¯•è®¡åˆ’ â­ NEW
â”œâ”€â”€ DEVELOPMENT_SPEC.md   # å¼€å‘è§„èŒƒ
â””â”€â”€ Cargo.toml
```

## é…ç½®è¯´æ˜

### [source] - å¤‡ä»½æºé…ç½®

- `url`: SMB å…±äº«è·¯å¾„ï¼ˆWindows UNC æ ¼å¼ï¼‰
- `username`: SMB ç”¨æˆ·å
- `password`: SMB å¯†ç ï¼ˆæ”¯æŒæ˜æ–‡æˆ– base64 ç¼–ç ï¼‰

### [target] - å¤‡ä»½ç›®æ ‡é…ç½®

- `tape_path`: ç£å¸¦è®¾å¤‡è·¯å¾„æˆ–æ¨¡æ‹Ÿæ–‡ä»¶è·¯å¾„
- `db_path`: å…ƒæ•°æ®æ•°æ®åº“è·¯å¾„

### [backup] - å¤‡ä»½è¡Œä¸ºé…ç½®

- `parallel_threads`: å¹¶è¡Œæ‰«æçº¿ç¨‹æ•°ï¼ˆé»˜è®¤ï¼šCPU æ ¸å¿ƒæ•°ï¼‰
- `compression_level`: Zstd å‹ç¼©çº§åˆ« 0-22ï¼ˆé»˜è®¤ï¼š3ï¼‰

## å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **å¯†ç å­˜å‚¨**ï¼š

- Base64 ç¼–ç ä»…æä¾›**æ¨¡ç³ŠåŒ–**ï¼Œä¸æ˜¯åŠ å¯†
- ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å°†å¯†ç å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­
- è€ƒè™‘ä½¿ç”¨ï¼š
  - Windows å‡­è¯ç®¡ç†å™¨ API
  - è¿è¡Œæ—¶å¯†ç æç¤º
  - ç¯å¢ƒå˜é‡ä¼ é€’

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Rust 2021 Edition
- **æ•°æ®åº“**: redb (åµŒå…¥å¼ KV å­˜å‚¨)
- **åºåˆ—åŒ–**: rkyv (é›¶æ‹·è´)
- **å“ˆå¸Œ**: BLAKE3 (SIMD åŠ é€Ÿ)
- **æ‰«æ**: jwalk (å¹¶è¡Œéå†)
- **é…ç½®**: TOML + serde
- **CLI**: clap

## ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] çœŸå® rustltfs è¿›ç¨‹é›†æˆ
- [ ] è¿›åº¦æ¡æ˜¾ç¤º
- [ ] è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Šï¼ˆè·³è¿‡/æ–°å¢/ä¿®æ”¹æ–‡ä»¶ï¼‰
- [ ] é…ç½®éªŒè¯å·¥å…·
- [ ] æ•°æ®åº“ä¿®å¤å·¥å…·
- [ ] æ–­ç‚¹ç»­ä¼ æ”¯æŒ

## è®¸å¯è¯

ï¼ˆå¾…å®šï¼‰

## è´¡çŒ®

åŸºäº DEVELOPMENT_SPEC.md ä¸­çš„å¼€å‘è§„èŒƒè¿›è¡Œå¼€å‘ã€‚
